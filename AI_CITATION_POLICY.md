# AI 助手引用来源政策

## 概述
为确保信息的真实性和可靠性，AI 助手在提供参考来源时必须遵守严格的规则。

## 核心原则

### 1. 真实性优先
- **绝对禁止**编造虚假的网站链接
- **绝对禁止**创造不存在的来源
- **绝对禁止**提供无法访问的 URL

### 2. 宁缺毋滥
- 如果不确定具体来源，不要使用 `<SOURCES>` 标签
- 如果无法提供真实链接，直接说明这是基于知识库的回答
- 诚实地承认信息来源的局限性

### 3. 验证要求
所有引用的来源必须满足：
- URL 必须是完整的（包含 http:// 或 https://）
- 网站必须真实存在且可访问
- 内容描述必须与实际网站内容相符
- 引用的文字必须真实存在于来源中

## 系统实现

### 引用指令
系统已在 API 层面添加了严格的引用规则：

```
关于引用来源的重要规则：
1. 只有在你确实知道真实存在的来源时，才使用 <SOURCES> 标签提供引用
2. 所有 url 必须是真实可访问的完整链接（含 http/https），绝对不能编造虚假网址
3. 如果你不确定具体来源或无法提供真实链接，请不要使用 <SOURCES> 标签
4. 宁可不提供来源，也不要编造虚假信息
5. 如果使用引用，在回复正文中使用 [n] 进行内联引用标注
6. JSON 数组项必须包含：number、title、url、description、quote 字段
7. 不要在正文中直接展开 JSON
```

### 系统提示词
默认系统提示词已更新，包含以下提醒：

```
重要提醒：如果需要提供参考来源，请确保所有链接和信息都是真实存在的，
绝对不要编造虚假的网站或来源。如果不确定来源，请直接说明这是基于你的
知识库回答，而不是提供虚假引用。
```

## Markdown 格式注意事项

### 表格中的引用
**禁止在 Markdown 表格内使用 `[n]` 引用标记**

原因：
- 引用标记会破坏表格的 Markdown 渲染
- 导致表格显示错乱或无法正确解析
- 影响用户阅读体验

解决方案：
1. 在表格外的正文中添加引用标记
2. 在表格后面的说明文字中引用来源
3. 如果必须说明表格数据来源，在表格标题或表格后添加说明

示例：
```markdown
以下是各地区需求指数数据 [1]：

| 地区 | 需求指数 | 日期 |
|------|----------|------|
| 山东 | 552.9 | 11月8日 |
| 重庆 | 426.8 | 11月17日 |

数据来源于农业部统计报告 [1]。
```

### 其他 Markdown 元素
- **代码块**：可以在代码块外添加引用
- **引用块**：可以在引用块外添加引用
- **列表**：可以在列表项中使用引用（不会破坏格式）

## 正确示例

### ✅ 有真实来源时
```
草莓的最佳生长温度是 15-25°C [1]。

<SOURCES>
[
  {
    "number": "1",
    "title": "草莓栽培技术指南 - 中国农业科学院",
    "url": "https://www.caas.cn/xwzx/kpyd/202301/t20230115_123456.html",
    "description": "详细介绍了草莓的生长环境要求",
    "quote": "草莓最适宜的生长温度范围为15-25°C"
  }
]
</SOURCES>
```

### ✅ 无确定来源时
```
草莓的最佳生长温度是 15-25°C。这是基于我的农业知识库提供的一般性建议，
具体温度要求可能因品种而异。建议咨询当地农业专家获取更准确的信息。
```

## 错误示例

### ❌ 编造虚假网站
```
草莓的最佳生长温度是 15-25°C [1]。

<SOURCES>
[
  {
    "number": "1",
    "title": "草莓种植百科",
    "url": "https://strawberry-guide.com/temperature",  // 虚假网站
    "description": "...",
    "quote": "..."
  }
]
</SOURCES>
```

### ❌ 使用不完整的 URL
```
<SOURCES>
[
  {
    "url": "www.example.com"  // 缺少 http:// 或 https://
  }
]
</SOURCES>
```

### ❌ 引用不存在的内容
```
<SOURCES>
[
  {
    "url": "https://real-website.com/page",
    "quote": "这段文字实际上不存在于该页面"  // 虚假引用
  }
]
</SOURCES>
```

### ❌ 在表格中使用引用标记
```markdown
| 地区 | 需求指数 |
|------|----------|
| 山东 | 552.9 [1] |  ❌ 这会破坏表格渲染
| 重庆 | 426.8 [2] |  ❌ 不要在表格内使用 [n]
```

**正确做法**：
```markdown
| 地区 | 需求指数 |
|------|----------|
| 山东 | 552.9 |  ✅ 表格中不使用引用标记
| 重庆 | 426.8 |  ✅ 保持表格简洁

根据最新数据 [1]，山东地区需求指数达到 552.9...
（在表格外的正文中使用引用标记）
```

## 用户指南

### 如何识别可靠的回答

**有来源的回答**：
- 检查提供的 URL 是否可以访问
- 验证网站是否是权威机构
- 确认引用内容是否与来源一致

**无来源的回答**：
- AI 会明确说明这是基于知识库的回答
- 建议用户进行额外验证
- 可能会推荐用户咨询专业人士

### 如何报告问题

如果发现 AI 提供了虚假来源：
1. 记录问题回答的内容
2. 验证 URL 是否可访问
3. 向系统管理员报告
4. 提供截图或具体描述

## 技术实现位置

### 相关文件
- `app/api/chat/route.ts` - 引用指令定义
- `components/ai-settings-dialog.tsx` - 默认系统提示词
- `app/api/settings/route.ts` - 设置 API 默认值

### 修改历史
- 2024-11-21: 初始版本，添加严格的引用来源验证规则

## 未来改进

### 计划中的功能
1. **URL 验证**：在后端自动验证提供的 URL 是否可访问
2. **来源评分**：对引用来源的可靠性进行评分
3. **用户反馈**：允许用户标记不准确的引用
4. **来源数据库**：维护一个可信来源的白名单

### 技术方案
```typescript
// 未来可能的实现
async function validateSource(url: string): Promise<boolean> {
  try {
    const response = await fetch(url, { method: 'HEAD' })
    return response.ok
  } catch {
    return false
  }
}
```

## 最佳实践

### 对于 AI 模型
1. 优先使用知名权威机构的来源
2. 提供多个来源以增加可信度
3. 明确区分事实和观点
4. 承认知识的局限性

### 对于用户
1. 始终验证重要信息的来源
2. 对于关键决策，咨询专业人士
3. 使用多个信息源进行交叉验证
4. 报告发现的任何虚假信息

## 总结

通过实施严格的引用来源政策，我们确保：
- ✅ 信息的真实性和可靠性
- ✅ 用户对 AI 助手的信任
- ✅ 符合信息伦理标准
- ✅ 避免误导用户

**记住**：宁可不提供来源，也不要编造虚假信息！
